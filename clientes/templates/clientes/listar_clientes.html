{% extends 'base.html' %}

{% block title %}Clientes{% endblock %}

{% block header %}
<h1>Lista de Clientes</h1>
{% endblock %}

{% block content %}
<br>
<h2>Clientes Cadastrados</h2>

<!-- AÇÕES E PESQUISA -->
<div class="top-bar">
    <!-- Botão à esquerda -->
    <div class="left-actions">
        <a href="{% url 'clientes:cadastrar_cliente' %}" class="btn">Cadastrar Cliente</a>
    </div>

    <!-- Pesquisa no centro -->
    <form method="get" action="{% url 'clientes:listar_clientes' %}" class="center-search">
        <input
            type="text"
            name="q"
            value="{{ query|default:'' }}"
            placeholder="Buscar por empresa, CNPJ ou código"
        />
        <button type="submit" class="btn">Buscar</button>
        {% if query %}
            <a href="{% url 'clientes:listar_clientes' %}" class="btn btn-secondary">Limpar</a>
        {% endif %}
    </form>

    <!-- Botão à direita -->
    <div class="right-actions">
        <a href="{% url 'core:dashboard' %}" class="btn btn-secondary">Voltar</a>
    </div>
</div>

<!-- TABELA BONITA -->
<div class="table-wrapper">
    <table>
        <thead>
            <tr>                
                <th>Cliente</th>
                <th>Sigla</th>
                <th>CNPJ</th>
                <th>Responsável</th>
                <th>Telefone</th>
                <th>Última Vistoria</th>
                <th>Quantidade Equipamentos</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente in clientes %}
            <tr>
                <td><a href="{% url 'clientes:detalhes_cliente' cliente.id %}">{{ cliente.nome_fantasia }}</a></td>
                <td>{{ cliente.sigla }}</td>
                <td>{{ cliente.cnpj }}</td>
                <td>{{ cliente.responsavel }}</td>
                <td>{{ cliente.numero_contrato }}</td>
                <td>{{ cliente.ultima_vistoria_data|date:"d/m/Y" }}</td>
                <td>{{ cliente.total_equipamentos }}</td>
                <td class="table-actions">
                    <a href="{% url 'clientes:editar_cliente' cliente.id %}">Editar</a>
                    <form method="POST" action="{% url 'clientes:excluir_cliente' cliente.id %}" onsubmit="return confirm('Tem certeza que deseja excluir este cliente?');">
                        {% csrf_token %}
                        <button type="submit">Excluir</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8">Nenhum cliente cadastrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
