{% extends 'base.html' %}
{% load static %}

{% block title %}Avaliação de Equipamento{% endblock %}

{% block header %}
<h1>Avaliação de Equipamento</h1>
{% endblock %}

{% block content %}
<br>
<div class="card-form">
    <h2 style="text-align: center;">Vistoria do Equipamento</h2>

    <p><strong>Equipamento:</strong> {{ equipamento.nome }}</p>
    <p><strong>Nº de Série:</strong> {{ equipamento.numero_serie }}</p><br>

    <form method="post" id="form-vistoria">
        {% csrf_token %}

        <!-- Parâmetros -->
        <h3 style="margin-bottom: 15px; color: var(--primary-color);">Parâmetros</h3>

        {% for parametro in parametros %}
        <fieldset style="margin-bottom: 25px; padding: 20px; border: 1px solid #ccc; border-radius: 8px;">
            <legend style="font-weight: bold; padding: 0 10px;">{{ parametro.nome }}</legend>

            <div class="form-group">
                {% for valor, nome in situacao_choices %}
                <label style="margin-right: 15px;">
                    <input
                        type="radio"
                        name="parametro_{{ parametro.id }}"
                        value="{{ valor }}"
                        required
                        class="situacao-radio"
                        data-param-id="{{ parametro.id }}"
                    > {{ nome }}
                </label>
                {% endfor %}
            </div>

            <div class="form-group gravidade-container" id="gravidade-{{ parametro.id }}" style="display: none;">
                <label for="gravidade_{{ parametro.id }}">Gravidade:</label>
                <select name="gravidade_{{ parametro.id }}">
                    <option value="">Selecione...</option>
                    <option value="leve">Leve</option>
                    <option value="medio">Médio</option>
                    <option value="grave">Grave</option>
                </select>
            </div>

            <div class="form-group">
                <label for="observacao_{{ parametro.id }}">Observações:</label>
                <textarea name="observacao_{{ parametro.id }}" rows="2" placeholder="Observações específicas..."></textarea>
            </div>
        </fieldset>
        {% endfor %}

        <!-- Status Final -->
        <hr><br>
        <div class="form-group">
                    <!-- Observações Gerais -->
            <div class="form-group">
                <label for="observacoes">Observações Gerais:</label>
                <textarea name="observacoes" id="observacoes" rows="3" placeholder="Digite observações gerais..."></textarea>
            </div>
            <label for="status_final">Status Final:</label>
            <select name="status_final" id="status_final" required>
                {% for valor, nome in status_choices %}
                <option value="{{ valor }}">{{ nome }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Botões -->
        <div class="form-actions">
            <button type="submit" class="btn">Salvar</button>
            <a href="{% url 'vistorias:equipamentos_para_vistoria' vistoria.id %}" class="btn btn-secondary">Voltar</a>
        </div>
    </form>
</div>

<!-- Script para exibir gravidade -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.situacao-radio').forEach(function (radio) {
            radio.addEventListener('change', function () {
                const paramId = this.dataset.paramId;
                const container = document.getElementById('gravidade-' + paramId);
                if (this.value === 'danificado') {
                    container.style.display = 'block';
                } else {
                    container.style.display = 'none';
                    container.querySelector('select').value = '';
                }
            });

            // Mostrar gravidade se já estiver marcado como danificado
            if (radio.checked && radio.value === 'danificado') {
                document.getElementById('gravidade-' + radio.dataset.paramId).style.display = 'block';
            }
        });
    });
</script>
{% endblock %}
