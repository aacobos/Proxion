{% extends 'base.html' %}
{% load static %}

{% block title %}Equipamentos para Vistoria{% endblock %}

{% block header %}
<h1>Equipamentos para Vistoria</h1>
{% endblock %}

{% block content %}
<br>
<h2>Lista de Equipamentos</h2>

<!-- AÇÕES E PESQUISA -->
<div class="top-bar">
    <div class="left-actions">
        <a href="{% url 'vistorias:detalhes_vistoria' vistoria.id %}" class="btn btn-outline">Ver Resumo</a>
    </div>

    <form method="get" class="center-search">
        <input
            type="text"
            name="q"
            value="{{ termo_busca|default:'' }}"
            placeholder="Buscar por nome, número de série ou avaliação"
        />
        <button type="submit" class="btn">Buscar</button>
    </form>

    <div class="right-actions">
        <a href="{% url 'vistorias:listar_vistorias' %}" class="btn btn-secondary">Voltar</a>
    </div>
</div>

<!-- TABELA -->
<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Equipamento</th>
                <th>Nº de Série</th>
                <th>Status Avaliação</th>
                <th>Última Vistoria</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for equipamento in equipamentos %}
            <tr>
                <td>{{ equipamento.nome }}</td>
                <td>{{ equipamento.numero_serie|default:"-" }}</td>
                <td>
                    {% if equipamento.avaliado %}
                        <span style="color: #28a745; font-weight: bold;">Avaliado</span>
                    {% else %}
                        <span style="color: #856404;">Pendente</span>
                    {% endif %}
                </td>
                <td>
                    {% if equipamento.data_ultima_vistoria %}
                        {{ equipamento.data_ultima_vistoria|date:"d/m/Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="table-actions">
                    {% if equipamento.avaliado %}
                        <button class="btn btn-secondary" disabled>Avaliado</button>
                    {% else %}
                        <a href="{% url 'vistorias:vistoria_equipamento_form' vistoria.id equipamento.id %}">Avaliar</a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">Nenhum equipamento encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- AÇÕES FINAIS -->
<div class="form-actions">
    <a href="{% url 'vistorias:finalizar_vistoria' vistoria.id %}" class="btn btn-outline">Finalizar Vistoria</a>
</div>
{% endblock %}
